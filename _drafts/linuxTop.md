---
layout: post
title: "Linux TOP命令详解(带知识点延伸)"
date: 2018-07-31 14:26:00 +0800
categories: linux
description: "Linux TOP命令详解(带知识点延伸)"
tag: linux
---

> * top命令是Linux下常用的性能分析工具，能够实时显示系统中各个进程的资源占用状况，类似于Windows的任务管理器。  
> * 运行 top 命令后，CPU 使用状态会以全屏的方式显示，并且会处在对话的模式。    
> * 退出 top 的命令为 q （在 top 运行中敲 q 键一次）。  
> * 可以单独查看某个用户或某个进程的情况，分别使用 top -u <进程所有者> 和 top -p <进程号>

<div align="center"><img src="{{ "/images/linuxTop/1.png" | prepend: site.baseurl }}" width="700" /></div>

## 第一部分：系统信息栏

### 第一行（top）：
* “10:08:45 up 10 days, 3:05”：‘10:19:40’为系统当前时间，‘up 10 days, 3:05’为系统启动后到现在的运作时间为10天3小时5分；
* “1 users”：当前登录到系统的用户数，更确切的说是登录到用户的终端数（*同一个用户同一时间对系统多个终端的连接将被视为多个用户连接到系统，这里的用户数也将表现为终端的数目*）；
* “load average 0.00, 0.00, 0.00”：当前系统负载的平均值，后面的三个值分别为1分钟前、5分钟前、15分钟前进程的平均数，一般的可以认为这个数值超过 CPU 数目时，CPU 将比较吃力的负载当前系统所包含的进程；

**延伸：**load average数据是每隔几秒钟(可使用内部命令‘s’进行设置)检查一次活跃的进程数，然后按特定算法计算出的数值。当有多核的时候，是会大于1的。比如2个CPU表明系统负荷可以达到2.0，此时每个CPU都达到100%的工作量。推广开来，n个CPU的电脑，可接受的系统负荷最大为n.0。

### 第二行（Tasks）：
* “135 total”：当前系统进程总数；
* “1 running”：当前运行中的进程数；
* “134 sleeping”：当前处于等待状态中的进程数；
* “0 stoped”：被停止的系统进程数；
* “0 zombie”：zombie（僵尸）状态进程数；

### 第三行（Cpus，默认显示整体的，按1则显示每个CPU的情况列表）：
* **0.3% us** — （user 的缩写）是 CPU 消耗在 **User space（用户空间）** 的时间百分比
* **0.0% sy** — （system 的缩写）是 CPU 消耗在 **Kernel space（内核空间）** 的时间百分比
* **0.0% ni** — （niceness 的缩写）是 CPU 消耗在 **nice进程（低优先级）** 的时间百分比
* **99.7% id** — （idle 的缩写）是 CPU 消耗在 **闲置进程** 的时间百分比，*这个值越低，表示 CPU 越忙*
* **0.0% wa** — （wait 的缩写）是 CPU 等待 **外部I/O** 的时间百分比，*这段时间 CPU 不能干其他事，但是也没有执行运算，这个值太高就说明外部设备有问题*
* **0.0% hi** — （hardware interrupt 的缩写）是 CPU 响应 **硬件中断请求** 的时间百分比
* **0.0% si** — （software interrupt 的缩写）是 CPU 响应 **软件中断请求** 的时间百分比
* **0.0% st** — （stole time 的缩写）该项指标只对虚拟机有效，表示分配给当前虚拟机的 CPU 时间之中，被同一台物理机上的其他虚拟机偷走的时间百分比

### 第四行（Mem）：
3808060k total — 物理内存总量（4GB）
3660048k used — 使用中的内存总量（3.6GB）
148012k free — 空闲内存总量（148M）
359760k buffers — 缓存的内存量 （359M）

### 第五行（Swap）：
4184924k total — 交换区总量（4G）
0k used — 使用的交换区总量（0M）
4184924k free — 空闲交换区总量（4G）
2483956k cached — 缓冲的交换区总量（2483M）

**延伸：**  
* **第四行中使用中的内存总量（used）指的是现在系统内核控制的内存数，空闲内存总量（free）是内核还未纳入其管控范围的数量。纳入内核控制的内存不见得都在使用中，还包括过去使用过的现在可以被重复利用的内存，内核并不把这些可被重新使用的内存交还到free中去，因此在linux上free内存会越来越少，但不用为此担心。**
* **如果出于习惯去计算可用内存数，这里有个近似的计算公式：第四行的free + 第四行的buffers + 第五行的cached，按这个公式此台服务器的可用内存：148M+259M+2483M = 2990M。**
* **对于内存监控，在top里我们要时刻监控第五行swap交换分区的used，如果这个数值在不断的变化，说明内核在不断进行内存和swap的数据交换，这是真正的内存不够用了。**

<br>
## 第二部分 — 中间部分的内部命令提示栏（绿色光标部分）

**可以通过 top 的内部命令对进程的显示方式进行控制**。内部命令如下：

* **s** – 改变画面更新频率
* **l** – 关闭或开启第一部分第一行 top 信息的表示
* **t** – 关闭或开启第一部分第二行 Tasks 和第三行 Cpus 信息的表示
* **m** – 关闭或开启第一部分第四行 Mem 和 第五行 Swap 信息的表示
* **N** – 以 PID 的大小的顺序排列表示进程列表（控制第三部分）
* **P** – 以 CPU 占用率大小的顺序排列进程列表 （控制第三部分）
* **M** – 以内存占用率大小的顺序排列进程列表 （控制第三部分）
* **h** – 显示帮助
* **n** – 设置在进程列表所显示进程的数量
* **q** – 退出 top

<br>
## 第三部分 — 最下部分的进程列表栏

**以 PID 区分的进程列表将根据所设定的画面更新时间定期的更新。通过 top 内部命令可以控制此处的显示方式**

各字段含义：

* **PID** – 进程的ID
* **USER** – 进程所有者
* **PR** – （Priority）进程的优先级别，是给内核（kernel）看（用）的，越小越优先被执行，一般情况下，PR=NI+20
* **NI** – （Nice value）优先值，是用户层面的概念，一般情况下，NI=PR-20
* **VIRT** – 进程占用的虚拟内存
* **RES** – 进程占用的物理内存
* **SHR** – 进程使用的共享内存
* **S** – 进程的状态。S表示休眠，R表示正在运行，Z表示僵死状态，N表示该进程优先值为负数
* **%CPU** – 进程占用CPU的使用率
* **%MEM** – 进程使用的物理内存和总内存的百分比
* **TIME+** – 该进程启动后占用的总的CPU时间，即占用CPU使用时间的累加值。
* **COMMAND** – 进程启动命令名称